<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flyers Part 4 Practice</title>
    
    <!-- Import thư viện React & Babel để chạy code trực tiếp trên trình duyệt -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Import TailwindCSS để nhận diện giao diện -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap');
        
        * {
            font-family: 'Nunito', 'Google Sans', sans-serif;
        }
        body {
            background-color: #F4FBF6;
        }
        .cloze-input {
            display: inline-block;
            border: none;
            border-bottom: 2px solid #9CA3AF;
            background: transparent;
            text-align: center;
            width: 110px;
            margin: 0 4px;
            padding: 0 4px;
            font-size: 1.15rem;
            outline: none;
            color: #E84393;
            font-weight: 800;
            transition: all 0.2s;
            border-radius: 4px 4px 0 0;
        }
        .cloze-input:focus {
            border-bottom-color: #E84393;
            background-color: #FDF2F8;
        }
        .cloze-input.correct {
            border-bottom-color: #15803D;
            color: #15803D;
            background-color: #DCFCE7;
        }
        .cloze-input.incorrect {
            border-bottom-color: #BE185D;
            color: #BE185D;
            text-decoration: line-through;
            background-color: #FCE7F3;
        }
        .options-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .options-scroll::-webkit-scrollbar-thumb {
            background-color: #A5D6A7;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <!-- Nơi ứng dụng React sẽ được render -->
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        /* ============================================================================
           ICONS (Thay thế cho thư viện lucide-react để chạy độc lập)
           ============================================================================ */
        const Play = ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>;
        const Clock = ({size=20, className=""}) => <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>;
        const CheckCircle = ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>;
        const ChevronRight = ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>;
        const RefreshCcw = ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="1 4 1 10 7 10"></polyline><polyline points="23 20 23 14 17 14"></polyline><path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path></svg>;
        const Award = ({size=80, className=""}) => <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline></svg>;

        /* ============================================================================
           CẤU HÌNH GIAO DIỆN & DỮ LIỆU
           ============================================================================ */
        const CONFIG = {
            colors: {
                primary: '#E84393',
                secondary: '#A5D6A7',
                background: '#F4FBF6',
                correct: '#15803D',
                incorrect: '#BE185D',
            },
            reviewTimeSeconds: 60,
            bannerUrl: 'https://www.dropbox.com/scl/fi/vil0vic87fl5tev5rg941/flyers-banner-1.jpg?rlkey=kpq60o038l840k2dzbzai21nh&st=3trt6sz6&raw=1'
        };

        const shuffleArray = (array) => {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        };

         const TEST_DATA = [
  {
    id: "flyers-4-test-1",
    title: "Tortoises",
    imageUrl: "https://www.dropbox.com/scl/fi/928ye3mf25fi7kknlij2m/flyers-4_test-1_part-4.png?rlkey=jffj6lyi03avujw5p5wbj6xnw&st=vxe7mtnv&raw=1",
    text: "<b>Tortoises are animals that have four legs and a hard shell [EX] their backs.</b> There isn’t only one kind of tortoise and [1] tortoise’s shell is a different shape. They have short legs and toes, and they do not have [2] teeth.\n\nThey pull their heads and necks inside their shells when they [3] afraid of something.\n\nTortoises eat plants, but there are some tortoises [4] eat snails and birds. Tortoises like to sleep for [5] of the day.\n\nSome tortoises live [6] they are very old. A few live [7] than 100 years! And on some islands, there are very large tortoises. [8] tortoises have lots of food to eat, [9] the animals grow big.\n\n[10] the weather gets cold, tortoises go to sleep for months.",
    example: { answer: "on", options: ["on", "up", "out"] },
    questions: [
        { id: 1, answer: "each", options: ["each", "another", "both"], explanation: "each (mỗi), another (một cái khác), both (cả hai). Dùng 'each' để chỉ từng con rùa một. 'each tortoise's shell' nghĩa là mai của mỗi con rùa." },
        { id: 2, answer: "any", options: ["every", "any", "no"], explanation: "every (mọi), any (bất kỳ), no (không). Trong câu phủ định (do not have), chúng ta dùng 'any'. 'do not have any teeth' nghĩa là không có cái răng nào cả." },
        { id: 3, answer: "feel", options: ["feel", "feels", "felt"], explanation: "feel (cảm thấy). Chủ ngữ là 'they' (số nhiều) và câu đang ở thì hiện tại đơn kể về thói quen của rùa, nên động từ 'feel' giữ nguyên không thêm 's'." },
        { id: 4, answer: "which", options: ["which", "what", "where"], explanation: "which (cái nào/con nào), what (cái gì), where (ở đâu). 'which' là đại từ quan hệ dùng thay thế cho con vật (some tortoises)." },
        { id: 5, answer: "most", options: ["many", "such", "most"], explanation: "many (nhiều), such (như vậy), most (hầu hết). Cụm từ 'most of the day' có nghĩa là 'phần lớn thời gian trong ngày'." },
        { id: 6, answer: "until", options: ["during", "until", "through"], explanation: "during (trong suốt), until (cho đến khi), through (xuyên qua). Vài con rùa sống 'cho đến khi' (until) chúng rất già." },
        { id: 7, answer: "longer", options: ["long", "longer", "longest"], explanation: "long (lâu/dài), longer (lâu hơn), longest (lâu nhất). Có từ 'than' (hơn) phía sau nên ta phải dùng dạng so sánh hơn là 'longer'." },
        { id: 8, answer: "These", options: ["These", "Them", "This"], explanation: "These (những cái/con này), Them (chúng - tân ngữ), This (cái/con này). 'tortoises' là số nhiều nên phải dùng 'These'." },
        { id: 9, answer: "so", options: ["because", "so", "or"], explanation: "because (bởi vì), so (vì vậy), or (hoặc). Những con rùa này có nhiều thức ăn, 'vì vậy' (so) chúng lớn rất nhanh." },
        { id: 10, answer: "When", options: ["Soon", "When", "Perhaps"], explanation: "Soon (sớm), When (khi), Perhaps (có lẽ). 'Khi' (When) thời tiết trở lạnh, rùa đi ngủ đông." }
    ]
  },
  {
    id: "flyers-4-test-2",
    title: "Swans",
    imageUrl: "https://www.dropbox.com/scl/fi/uxlukvoxa64tg55h9ocjm/flyers-4_test-2_part-4.png?rlkey=o7ywq1wfp3rpetcwewpvtojfm&st=p0vzv9pr&raw=1",
    text: "<b>A swan is a bird [EX] always lives near water.</b>\nIt is like a duck, but much [1] , with a very long neck. Swans have heavy bodies, but their wings are very strong [2] they can fly well.\nSwans can sleep in or out of the water, and they can [3] go to sleep when they are standing on one leg!\nSwans live in several different countries. They are [4] white, but in some places there are black ones too.\nMost swans fly to warmer countries [5] the winter starts. This is called ‘migration’.\nA baby swan is called a ‘cygnet’. Cygnets are grey and can swim as [6] as they come out of their eggs. A mother swan often carries her young cygnets [7] her back when she’s swimming. She does this to keep [8] safe.\nSwans are clever birds. If a person does something unkind to a swan, it will [9] that person. You shouldn’t go too near to a swan – they can sometimes [10] dangerous.",
    example: { answer: "which", options: ["which", "it", "where"] },
    questions: [
      { id: 1, answer: "larger", options: ["large", "larger", "largest"], explanation: "large (lớn), larger (lớn hơn), largest (lớn nhất). Có từ 'much' đứng trước để nhấn mạnh so sánh hơn -> larger." },
      { id: 2, answer: "so", options: ["so", "while", "after"], explanation: "so (vì vậy), while (trong khi), after (sau khi). Cánh của chúng rất khỏe, 'vì vậy' (so) chúng có thể bay rất giỏi." },
      { id: 3, answer: "also", options: ["ever", "instead", "also"], explanation: "ever (bao giờ), instead (thay vì), also (cũng). Chúng 'cũng' (also) có thể đi ngủ trong khi đang đứng một chân." },
      { id: 4, answer: "usually", options: ["later", "usually", "yet"], explanation: "later (sau đó), usually (thường xuyên), yet (chưa). Thiên nga 'thường' (usually) có màu trắng." },
      { id: 5, answer: "before", options: ["before", "during", "since"], explanation: "before (trước khi), during (trong suốt), since (từ khi). Bay về phương nam 'trước khi' (before) mùa đông bắt đầu." },
      { id: 6, answer: "soon", options: ["far", "soon", "much"], explanation: "far (xa), soon (sớm), much (nhiều). Cụm từ 'as soon as' có nghĩa là 'ngay khi'." },
      { id: 7, answer: "on", options: ["on", "in", "by"], explanation: "on (trên), in (trong), by (bởi/cạnh). Cõng 'trên' lưng thì chúng ta dùng giới từ 'on' (on her back)." },
      { id: 8, answer: "them", options: ["it", "us", "them"], explanation: "it (nó), us (chúng ta), them (chúng/họ). Giữ an toàn cho 'chúng' (thiên nga con - số nhiều) -> dùng 'them'." },
      { id: 9, answer: "remember", options: ["remembered", "remember", "remembers"], explanation: "remember (nhớ). Sau 'will' (tương lai đơn), động từ phải ở dạng nguyên mẫu không 'to' -> remember." },
      { id: 10, answer: "be", options: ["being", "be", "been"], explanation: "be (thì/là). Tương tự, sau 'can' động từ cũng phải ở dạng nguyên mẫu. 'dangerous' là tính từ nên ta cần động từ to-be -> 'be'." }
    ]
  },
  {
    id: "flyers-4-test-3",
    title: "The history of golf",
    imageUrl: "https://www.dropbox.com/scl/fi/obb67zmli38y3n4hj06uk/flyers-4_test-3_part-4.png?rlkey=pffhk4kbdcvo4j0j117wd597z&st=qz1ith1x&raw=1",
    text: "<b>Golf is a very popular game in [EX] countries.</b>\nThe place where people play golf [1] called a ‘golf course’. There are about 32,000 golf courses in the world and the [2] one is 400 years old. This is in Scotland, [3] has some of the best golf courses in the world.\nThe kind of golf that people play today [4] in Scotland more than five hundred years [5] .\nMost big golf courses have 18 holes. Players try to hit a small ball into [6] hole on the golf course by only hitting the ball a few times.\n[7] there were golf courses, people played [8] beaches and hit stones into holes in the sand.\nGolf courses [9] to have lots of space and very green grass. In some countries where it doesn’t rain a lot, this can [10] a problem because they need to use a lot of water to keep the grass green.",
    example: { answer: "many", options: ["many", "much", "both"] },
    questions: [
      { id: 1, answer: "is", options: ["has", "does", "is"], explanation: "has (có), does (làm), is (thì/là/bị). Dùng thể bị động 'is called' (được gọi là). Nơi chơi golf được gọi là sân golf." },
      { id: 2, answer: "oldest", options: ["old", "older", "oldest"], explanation: "old (cũ), older (cũ hơn), oldest (cũ nhất). Có mạo từ 'the' phía trước nên dùng so sánh nhất -> 'the oldest one'." },
      { id: 3, answer: "which", options: ["who", "which", "when"], explanation: "who (ai), which (cái nào), when (khi nào). Dùng đại từ quan hệ 'which' thay thế cho vật/địa điểm (Scotland) ở mệnh đề trước." },
      { id: 4, answer: "started", options: ["start", "starts", "started"], explanation: "start (bắt đầu). Kể về chuyện quá khứ (hơn 500 năm trước) nên dùng thì quá khứ đơn -> 'started'." },
      { id: 5, answer: "ago", options: ["already", "ago", "ever"], explanation: "already (rồi), ago (trước đây), ever (bao giờ). Cụm từ chỉ thời gian trong quá khứ: 'five hundred years ago' (500 năm trước)." },
      { id: 6, answer: "each", options: ["each", "another", "such"], explanation: "each (mỗi), another (cái khác), such (như vậy). Đánh bóng vào 'mỗi' lỗ (each hole) trên sân golf." },
      { id: 7, answer: "Before", options: ["If", "So", "Before"], explanation: "If (nếu), So (vì vậy), Before (trước khi). 'Trước khi' (Before) có sân golf, mọi người thường chơi trên bãi biển." },
      { id: 8, answer: "on", options: ["on", "under", "for"], explanation: "on (trên), under (dưới), for (cho). Giới từ đi với bãi biển (beaches) là 'on' (trên bãi biển)." },
      { id: 9, answer: "need", options: ["need", "could", "must"], explanation: "need (cần), could (có thể), must (phải). Sau chỗ trống là 'to have'. Chỉ có 'need to' (cần phải) là hợp lý." },
      { id: 10, answer: "be", options: ["been", "being", "be"], explanation: "be (thì/là). Sau 'can' dùng động từ nguyên mẫu. Trở thành một vấn đề -> 'can be a problem'." }
    ]
  },
  {
    id:"flyers-3-test-1",
    title:"Octopuses",
    imageUrl:"https://www.dropbox.com/scl/fi/7imy58opcte4le1x0wtmj/flyers-3_test-1_part-4.png?rlkey=xt5jymgxk3cpf1df85gjpoasv&st=fa1e8q7y&raw=1",
    text:"<b>An octopus is a creature [EX] lives in the sea.</b> It has a round head with two large eyes. People often think that octopuses have eight legs, but they [1] have four pairs of arms. Octopuses live in oceans all [2] the world. Octopuses that live in warm water are small, and [3] that live in cold water are much [4]. Most octopuses are 'nocturnal'. This means that they sleep [5] day, and move around and eat at night. Octopuses usually live [6] one or two years. To move, octopuses usually use their arms to walk [7] the bottom of the sea. When they need to, they can swim at forty kilometres an hour for a short time. [8] an octopus needs to hide from [9] creatures, it can change colour. It can also get into very small spaces because its body is very soft. Octopuses are very clever. For example, they can [10] new things and open bottles. Octopuses can see very well with their large eyes, but they can’t hear anything.",
    example:{answer:"which",options:["which","it","where"]},
    questions:[
      {id:1,answer:"actually",options:["quite","actually","still"],explanation:"quite (khá), actually (thực ra), still (vẫn). Người ta nghĩ bạch tuộc có 8 chân, nhưng 'thực ra' chúng có 4 cặp tay."},
      {id:2,answer:"around",options:["about","of","around"],explanation:"Cụm cố định 'all around the world' (trên toàn thế giới)."},
      {id:3,answer:"those",options:["both","those","each"],explanation:"Dùng 'those' để thay thế cho 'octopuses' ở vế trước."},
      {id:4,answer:"bigger",options:["bigger","big","biggest"],explanation:"Có 'much' phía trước nên dùng so sánh hơn 'bigger'."},
      {id:5,answer:"all",options:["all","some","the"],explanation:"Cụm 'all day' nghĩa là suốt cả ngày."},
      {id:6,answer:"for",options:["during","since","for"],explanation:"Dùng 'for' để chỉ khoảng thời gian (for one or two years)."},
      {id:7,answer:"along",options:["past","along","between"],explanation:"'walk along the bottom' = đi dọc theo đáy biển."},
      {id:8,answer:"If",options:["Before","If","While"],explanation:"If (nếu). Nếu bạch tuộc cần trốn, nó có thể đổi màu."},
      {id:9,answer:"other",options:["more","every","other"],explanation:"'other creatures' = những sinh vật khác."},
      {id:10,answer:"learn",options:["learn","learning","learned"],explanation:"Sau 'can' dùng động từ nguyên mẫu → learn."}
    ]
  },
  {
    id:"flyers-3-test-2",
    title:"Camels",
    imageUrl:"https://www.dropbox.com/scl/fi/kz6b06i68mkl4qzjt6asv/flyers-3_test-2_part-4.png?rlkey=omjhmwh9d6ivr4el8n9zqjuqz&st=yuf774rr&raw=1",
    text:"<b>Camels have unusual shapes on their backs. These are [EX] ‘humps’.</b>\n\n[1] are two kinds of camel. The first kind has one hump on [2] back and the other kind has two humps.\n\nMost camels in the world live [3] the weather is hot and dry - in places like deserts, for example. The people [4] also live in these places might [5] camels to carry all their heavy things on long journeys. These people have [6] camels for thousands of years, too.\n\nCamels can live without food or water for six months and most camels live [7] forty and fifty years! About fourteen million camels live in the world at the moment.\n\nIt is easier for camels to live in deserts [8] for other animals because their bodies are high above the hot ground and their large feet help them [9] quickly across sand.\n\nA camel can run across sand really fast. [10] camels can travel 45 kilometres in one hour.",
    example:{answer:"called",options:["call","calling","called"]},
    questions:[
      {id:1,answer:"There",options:["They","There","Those"],explanation:"Nghĩa: They (họ/chúng - chủ ngữ), There (có/ở đó - dùng để nói 'có ...'), Those (những cái/những người đó). Mẫu câu đúng: 'There are ...' = 'Có ...' -> 'There are two kinds of camel'."},
      {id:2,answer:"its",options:["your","my","its"],explanation:"Nghĩa: your (của bạn), my (của tôi), its (của nó). Nói về 'the first kind' (một loại lạc đà - số ít) nên dùng 'its back' = lưng của nó."},
      {id:3,answer:"where",options:["where","when","why"],explanation:"Nghĩa: where (nơi mà), when (khi mà), why (tại sao). 'live where the weather is hot and dry' = sống ở nơi thời tiết nóng và khô -> chọn 'where'."},
      {id:4,answer:"who",options:["who","what","which"],explanation:"Nghĩa: who (người mà), what (cái gì), which (cái mà/điều mà). 'The people who also live...' vì 'people' là người -> dùng 'who'."},
      {id:5,answer:"use",options:["used","use","using"],explanation:"Nghĩa: used (đã dùng/quá khứ), use (dùng), using (đang dùng/việc dùng). Sau 'might' dùng động từ nguyên mẫu -> 'might use' (có thể dùng) camels để chở đồ."},
      {id:6,answer:"used",options:["ride","rode","ridden"],explanation:"Nghĩa: ride (cưỡi), rode (đã cưỡi), ridden (đã được cưỡi). Ở đây là cấu trúc 'have + V3' (hiện tại hoàn thành): 'have used' = đã dùng trong nhiều năm. Trong 3 lựa chọn, chỉ 'used' là V3 của 'use' (dùng) -> chọn 'used'."},
      {id:7,answer:"between",options:["during","between","until"],explanation:"Nghĩa: during (trong suốt - trong một khoảng thời gian), between (giữa ... và ...), until (cho đến khi). 'between forty and fifty years' = giữa 40 và 50 năm -> dùng 'between'."},
      {id:8,answer:"than",options:["than","while","if"],explanation:"Nghĩa: than (hơn/so với), while (trong khi), if (nếu). Cấu trúc so sánh: 'easier ... than ...' = dễ hơn ... so với ... -> chọn 'than'."},
      {id:9,answer:"move",options:["moved","moving","move"],explanation:"Nghĩa: moved (đã di chuyển), moving (đang di chuyển/việc di chuyển), move (di chuyển). Sau 'help + someone + V' dùng động từ nguyên mẫu -> 'help them move quickly' = giúp chúng di chuyển nhanh."},
      {id:10,answer:"Many",options:["Many","Lots","Much"],explanation:"Nghĩa: Many (nhiều - dùng với danh từ đếm được), Lots (nhiều - thường dùng 'lots of'), Much (nhiều - dùng với danh từ không đếm được). 'camels' là danh từ số nhiều đếm được -> 'Many camels...' đúng nhất."}
    ]
  },
  {
    id:"flyers-3-test-3",
    title:"Skyscrapers",
    imageUrl:"https://www.dropbox.com/scl/fi/hyn7h17uq66b9xrl3wggc/flyers-3_test-3_part-4.png?rlkey=wr4c13szug3twb25atcpfy34z&st=nhiowarl&raw=1",
    text:"<b>Many large cities [EX] the world have skyscrapers.</b>\n\nIn the past, a ‘skyscraper’ was a kind of high sail on a sailing ship. But today the word ‘skyscraper’ means a very [1] building. Some people think that a building can only be [2] a skyscraper when it has more than 50 floors, but others do [3] agree.\n\nA long time [4], buildings were usually only five or six floors high. Then, in 1852, Elisha Otis, a mechanic, invented a lift [5] was safe and could carry passengers up and down many floors. At the same time, engineers were [6] stronger and lighter kinds of metal. With these lifts and metals, engineers could [7] very high skyscrapers for people to live and work in.\n\nMany people think that skyscrapers are ugly because they look [8] big boxes. But the [9] famous ones have interesting shapes and colours. Also, [10] the top floors of skyscrapers you can see amazing views!",
    example:{answer:"in",options:["in","of","from"]},
    questions:[
      {id:1,answer:"tall",options:["tallest","taller","tall"],explanation:"Nghĩa: tall (cao), taller (cao hơn), tallest (cao nhất). Sau 'a very' dùng tính từ gốc -> 'a very tall building' (một tòa nhà rất cao)."},
      {id:2,answer:"called",options:["calling","called","call"],explanation:"Nghĩa: calling (đang gọi/việc gọi), called (được gọi là), call (gọi). Cấu trúc bị động: 'be called + name' = được gọi là -> 'can only be called a skyscraper'."},
      {id:3,answer:"not",options:["not","no","never"],explanation:"Nghĩa: not (không), no (không - đứng trước danh từ), never (không bao giờ). Cụm đúng: 'do not agree' = không đồng ý -> chọn 'not'."},
      {id:4,answer:"ago",options:["since","ago","already"],explanation:"Nghĩa: since (từ khi), ago (cách đây), already (đã rồi). 'A long time ago' = cách đây rất lâu -> chọn 'ago'."},
      {id:5,answer:"which",options:["what","where","which"],explanation:"Nghĩa: what (cái gì), where (nơi mà), which (cái mà). 'a lift which was safe' - 'lift' là vật -> dùng 'which'."},
      {id:6,answer:"making",options:["make","making","made"],explanation:"Nghĩa: make (làm), making (đang làm), made (đã làm). Sau 'were' (quá khứ tiếp diễn) dùng V-ing -> 'were making' (đang làm ra) các loại kim loại mạnh hơn, nhẹ hơn."},
      {id:7,answer:"design",options:["designing","designed","design"],explanation:"Nghĩa: designing (đang thiết kế/việc thiết kế), designed (đã thiết kế), design (thiết kế). Sau 'could' dùng động từ nguyên mẫu -> 'could design' (có thể thiết kế) các tòa nhà rất cao."},
      {id:8,answer:"like",options:["so","as","like"],explanation:"Nghĩa: so (vì vậy/rất), as (như - thường đi với so/as), like (giống như). 'look like big boxes' = trông giống những cái hộp to -> chọn 'like'."},
      {id:9,answer:"most",options:["another","most","much"],explanation:"Nghĩa: another (một cái khác), most (nhất/hầu hết - trong 'the most'), much (nhiều - không đếm được). 'the most famous ones' = những cái nổi tiếng nhất -> chọn 'most'."},
      {id:10,answer:"from",options:["through","from","with"],explanation:"Nghĩa: through (xuyên qua), from (từ), with (với/bằng). 'from the top floors' = từ các tầng trên cùng, bạn có thể nhìn thấy cảnh đẹp -> chọn 'from'."}
    ]
  },
  {
    id:"flyers-2-test-1",
    title:"Swans",
    imageUrl:"https://www.dropbox.com/scl/fi/c9irdal936l68icix8ms6/flyers-2_test-1_part-4.png?rlkey=ude959gup3n0od81557t0t9tz&st=458tlidp&raw=1",
    text:"<b>Swans are [EX] largest birds in the duck family.</b> There are six different kinds [1] swans which have white bodies, but in a few parts of the world there are black swans too. Swans are clever and remember people who have [2] kind or unkind to them! A frightened [3] really angry swan can break a man’s leg [4] its strong wings!\n\nSwans live on rivers and lakes. But in the winter months, some might live near the sea because salt water is usually a little [5] than river water. Swans don’t usually fly very far from the place [6] they build their nests. It takes between 35 and 42 days for a baby swan, which [7] called a ‘cygnet’, to break open its egg! A baby swan can be grey [8] white. Wild swans usually live for about seven years, but some live a lot longer. A swan eats underwater plants. It finds these by [9] its long neck deep into the water and its tail up into the air! Swans might [10] eat small frogs and insects.",
    example:{answer:"the",options:["the","a","one"]},
    questions:[
      {id:1,answer:"of",options:["of","up","off"],explanation:"Nghĩa: of (của/thuộc về), up (lên), off (ra khỏi/rời khỏi). Cụm đúng là 'kinds of + noun' = 'các loại ...' -> 'kinds of swans'."},
      {id:2,answer:"been",options:["be","been","being"],explanation:"Nghĩa: be (là/ở), been (đã là/đã ở - dạng V3), being (đang là/đang ở). Sau 'have' dùng V3 trong thì hiện tại hoàn thành -> 'have been kind' (đã từng/kể từ trước đến nay đối xử tử tế)."},
      {id:3,answer:"or",options:["or","because","while"],explanation:"Nghĩa: or (hoặc), because (bởi vì), while (trong khi). Cấu trúc: 'A frightened or really angry swan...' = 'Một con thiên nga sợ hãi HOẶC rất tức giận...' -> cần 'or' để nối 2 tình huống."},
      {id:4,answer:"with",options:["out","at","with"],explanation:"Nghĩa: out (ra ngoài), at (ở/tại), with (bằng/với). 'break a man’s leg with its strong wings' = làm gãy chân bằng đôi cánh khỏe -> dùng 'with' (bằng)."},
      {id:5,answer:"warmer",options:["warm","warmer","warmest"],explanation:"Nghĩa: warm (ấm), warmer (ấm hơn), warmest (ấm nhất). Có 'than' phía sau -> dùng so sánh hơn: 'a little warmer than' (ấm hơn một chút so với)."},
      {id:6,answer:"where",options:["who","if","where"],explanation:"Nghĩa: who (người mà), if (nếu), where (nơi mà). 'the place where they build their nests' = nơi mà chúng làm tổ -> 'where' chỉ nơi chốn."},
      {id:7,answer:"is",options:["are","is","was"],explanation:"Nghĩa: are (là - số nhiều), is (là - số ít), was (đã là - quá khứ). 'a baby swan, which is called a cygnet' -> 'which' thay cho 'a baby swan' (số ít) nên dùng 'is'."},
      {id:8,answer:"not",options:["not","nowhere","no"],explanation:"Nghĩa: not (không), nowhere (không ở đâu), no (không - đứng trước danh từ). 'can be grey, not white' = có thể màu xám, KHÔNG phải màu trắng -> dùng 'not'."},
      {id:9,answer:"putting",options:["puts","put","putting"],explanation:"Nghĩa: puts (đặt/đưa - thêm s), put (đặt/đưa), putting (việc đặt/đang đặt - V-ing). Sau 'by' luôn dùng V-ing: 'by putting its long neck...' = bằng cách đưa/đặt cổ dài xuống nước."},
      {id:10,answer:"also",options:["ever","also","yet"],explanation:"Nghĩa: ever (đã từng), also (cũng), yet (chưa - thường dùng trong phủ định/câu hỏi). 'Swans might also eat...' = thiên nga cũng có thể ăn... -> 'also'."}
    ]
  },
  {
    id:"flyers-2-test-2",
    title:"Kites",
    imageUrl:"https://www.dropbox.com/scl/fi/fq1erw8vpgk7gswfgkq27/flyers-2_test-2_part-4.png?rlkey=5ai0bged35vgh43nibctvri3m&st=h4mojf0l&raw=1",
    text:"<b>Kites have [EX] popular for over two thousand years.</b> Some people think that the first kites were made [1] leaves from trees. Kites can be [2] different shapes and sometimes they can look like animals or strange creatures.\n\nThey can be really small or enormous. It is often difficult to fly a kite for a long time [3] there has to be enough wind.\n\nIt can take a lot of practice to learn to fly a kite [4].\n\nKites are [5] always toys for children. A lot of grown-ups love flying [6] too. There are special racing kites that people use in competitions. In some countries there are huge kite festivals [7] you can see hundreds of kites in the air at the same time.\n\nSome clever people have also [8] kites to learn more about the weather. They put special cameras on kites to help [9] find out about places that are too difficult or dangerous to [10] on the ground.",
    example:{answer:"been",options:["be","been","being"]},
    questions:[
      {id:1,answer:"of",options:["in","of","up"],explanation:"Nghĩa: in (trong), of (từ/bằng - chỉ chất liệu), up (lên). 'made of leaves' = làm từ lá cây (nói về vật liệu)."},
      {id:2,answer:"many",options:["many","any","every"],explanation:"Nghĩa: many (nhiều), any (bất kỳ), every (mọi). 'many different shapes' = nhiều hình dạng khác nhau -> 'many' hợp nghĩa nhất."},
      {id:3,answer:"because",options:["because","while","if"],explanation:"Nghĩa: because (bởi vì), while (trong khi), if (nếu). Câu giải thích lý do: khó bay lâu BỞI VÌ phải có đủ gió -> 'because'."},
      {id:4,answer:"well",options:["else","well","ever"],explanation:"Nghĩa: else (khác/nữa), well (giỏi/tốt), ever (đã từng). 'learn to fly a kite well' = học bay diều giỏi/bay tốt -> dùng 'well'."},
      {id:5,answer:"not",options:["nothing","no","not"],explanation:"Nghĩa: nothing (không có gì), no (không - đứng trước danh từ), not (không - phủ định). 'Kites are not always...' = diều không phải lúc nào cũng... -> cần 'not' để phủ định."},
      {id:6,answer:"them",options:["them","they","their"],explanation:"Nghĩa: them (chúng - tân ngữ), they (chúng - chủ ngữ), their (của chúng). Sau 'love flying' cần tân ngữ (bay cái gì) -> 'flying them' (bay diều) đúng."},
      {id:7,answer:"where",options:["who","where","how"],explanation:"Nghĩa: who (người mà), where (nơi mà), how (cách mà). 'festivals where you can see...' = lễ hội nơi bạn có thể thấy... -> 'where' chỉ nơi chốn."},
      {id:8,answer:"used",options:["use","using","used"],explanation:"Nghĩa: use (dùng), using (đang dùng/việc dùng), used (đã dùng - V3). 'have also used' là hiện tại hoàn thành: have + V3 -> chọn 'used'."},
      {id:9,answer:"us",options:["we","us","our"],explanation:"Nghĩa: we (chúng tôi - chủ ngữ), us (chúng tôi - tân ngữ), our (của chúng tôi). 'help us find out' -> sau 'help' cần tân ngữ -> 'us'."},
      {id:10,answer:"explore",options:["explore","exploring","explored"],explanation:"Nghĩa: explore (khám phá), exploring (đang khám phá), explored (đã khám phá). Sau 'to' dùng động từ nguyên mẫu: 'dangerous to explore' = nguy hiểm để khám phá -> chọn 'explore'."}
    ]
  },
  {
    id:"flyers-2-test-3",
    title:"X-rays",
    imageUrl:"https://www.dropbox.com/scl/fi/wfh96h7g34b57gt0fbuox/flyers-2_test-3_part-4.png?rlkey=9ngyl9qwwh48hlx02lv2cks3k&st=c9gr3ilq&raw=1",
    text:"<b>When [EX] breaks an arm or leg, they need to go to hospital to have an x-ray.</b> An x-ray is a special kind of photo [1] helps doctors to see inside a person’s body.\n\nDentists [2] use x-ray machines to fix problems. X-ray photos can show the dentist where there are any broken teeth or teeth that have holes in [3]. A man called Wilhelm Rontgen invented the x-ray machine [4] the end of the 19th century. The first x-ray that he [5] was of his wife’s hand. Rontgen won prizes for his important new idea.\n\nPeople used x-rays to help [6] shoes in the middle of the last century, too. They used the machine to help them choose the [7] shoes.\n\nWe [8] find x-ray machines in shoe shops now, but they are [9] in airports. These machines look inside rucksacks and [10] bags that people take on planes.",
    example:{answer:"someone",options:["someone","everything","anywhere"]},
    questions:[
      {id:1,answer:"which",options:["what","which","who"],explanation:"Nghĩa: what (cái gì), which (cái mà), who (người mà). Ở đây nói về 'photo' (vật) nên dùng đại từ quan hệ 'which': 'a photo which helps...'."},
      {id:2,answer:"also",options:["also","once","else"],explanation:"Nghĩa: also (cũng), once (một lần), else (khác/nữa). 'Dentists also use...' = nha sĩ cũng dùng... -> 'also'."},
      {id:3,answer:"them",options:["its","one","them"],explanation:"Nghĩa: its (của nó - số ít), one (một cái), them (chúng - số nhiều). 'teeth' là số nhiều nên nói 'holes in them' = lỗ trên chúng (những chiếc răng)." },
      {id:4,answer:"at",options:["since","at","over"],explanation:"Nghĩa: since (từ khi), at (vào/lúc), over (trong suốt/hơn). Cụm đúng: 'at the end of the 19th century' = vào cuối thế kỷ 19."},
      {id:5,answer:"took",options:["took","take","taken"],explanation:"Nghĩa: took (đã chụp/lấy), take (chụp/lấy), taken (đã được chụp - V3). Câu kể chuyện quá khứ -> dùng quá khứ đơn: 'he took'."},
      {id:6,answer:"sell",options:["sell","sold","selling"],explanation:"Nghĩa: sell (bán), sold (đã bán), selling (việc bán/đang bán). Sau 'help' dùng động từ nguyên mẫu: 'help sell shoes' = giúp bán giày."},
      {id:7,answer:"best",options:["good","better","best"],explanation:"Nghĩa: good (tốt), better (tốt hơn), best (tốt nhất). 'choose the best shoes' = chọn đôi giày tốt nhất -> cần 'best'."},
      {id:8,answer:"don’t",options:["aren’t","haven’t","don’t"],explanation:"Nghĩa: aren’t (không phải/không là), haven’t (chưa có), don’t (không - phủ định động từ). 'We don’t find...' = chúng ta không còn thấy... (phủ định động từ find) -> 'don’t'."},
      {id:9,answer:"usually",options:["most","usually","much"],explanation:"Nghĩa: most (hầu hết), usually (thường), much (nhiều - dùng với không đếm được). 'they are usually in airports' = chúng thường ở sân bay -> trạng từ tần suất 'usually'."},
      {id:10,answer:"other",options:["each","other","every"],explanation:"Nghĩa: each (mỗi), other (khác), every (mọi). 'rucksacks and other bags' = ba lô và các loại túi khác -> 'other'."}
    ]
  }
];


        /* ============================================================================
           MAIN APP LOGIC
           ============================================================================ */
        function App() {
            const [screen, setScreen] = useState('welcome'); 
            const [studentName, setStudentName] = useState('');
            const [numTests, setNumTests] = useState(1);
            
            const [testsToPlay, setTestsToPlay] = useState([]);
            const [currentTestIdx, setCurrentTestIdx] = useState(0);
            
            const [answers, setAnswers] = useState({});
            const [results, setResults] = useState({});
            
            const [timeLeft, setTimeLeft] = useState(0);
            const timerRef = useRef(null);

            const [sessionStats, setSessionStats] = useState({
                startTime: null,
                endTime: null,
                testScores: [] 
            });

            const getDurationString = (start, end) => {
                if (!start || !end) return '';
                const diff = Math.floor((end - start) / 1000);
                const m = Math.floor(diff / 60);
                const s = diff % 60;
                return `${m} min ${s} sec`;
            };

            const startGame = (e) => {
                e.preventDefault();
                if (!studentName.trim()) {
                alert("Please enter the student's name!");
                return;
                }

                const shuffledData = shuffleArray(TEST_DATA);
                const selected = shuffledData.slice(0, numTests);
                
                const preparedTests = selected.map(test => {
                const pTest = { ...test, questions: [] };
                test.questions.forEach(q => {
                    pTest.questions.push({
                    ...q,
                    options: shuffleArray(q.options) 
                    });
                });
                return pTest;
                });

                setTestsToPlay(preparedTests);
                setCurrentTestIdx(0);
                setAnswers({});
                setResults({});
                setSessionStats({
                startTime: new Date(),
                endTime: null,
                testScores: []
                });
                setScreen('test');
            };

            const handleInputChange = (qId, value) => {
                setAnswers(prev => ({ ...prev, [qId]: value }));
            };

            const handleSubmit = () => {
                const currentTest = testsToPlay[currentTestIdx];
                let correctCount = 0;
                const newResults = {};

                currentTest.questions.forEach(q => {
                const studentAns = (answers[q.id] || '').trim().toLowerCase();
                const correctAns = q.answer.trim().toLowerCase();
                const isCorrect = studentAns === correctAns;
                
                if (isCorrect) correctCount++;
                
                newResults[q.id] = {
                    isCorrect,
                    expected: q.answer,
                    actual: answers[q.id] || ''
                };
                });

                setSessionStats(prev => {
                const scores = [...prev.testScores];
                if (scores.length === currentTestIdx) {
                    scores.push({
                    title: currentTest.title,
                    correct: correctCount,
                    total: currentTest.questions.length
                    });
                }
                return { ...prev, testScores: scores };
                });

                setResults(newResults);

                if (correctCount === currentTest.questions.length) {
                setScreen('review');
                setTimeLeft(3); 
                startTimer(3, true);
                } else {
                setScreen('review');
                setTimeLeft(CONFIG.reviewTimeSeconds);
                startTimer(CONFIG.reviewTimeSeconds, false);
                }
            };

            const startTimer = (seconds, autoNext) => {
                clearInterval(timerRef.current);
                timerRef.current = setInterval(() => {
                setTimeLeft((prev) => {
                    if (prev <= 1) {
                    clearInterval(timerRef.current);
                    handleReviewTimeout(autoNext);
                    return 0;
                    }
                    return prev - 1;
                });
                }, 1000);
            };

            const handleReviewTimeout = (autoNext) => {
                const currentTest = testsToPlay[currentTestIdx];
                const isAllCorrect = currentTest.questions.every(q => results[q.id]?.isCorrect);

                if (isAllCorrect || autoNext) {
                goToNextTestOrResult();
                } else {
                resetIncorrectAnswers();
                }
            };

            const skipReview = () => {
                clearInterval(timerRef.current);
                handleReviewTimeout(false);
            };

            const resetIncorrectAnswers = () => {
                setAnswers(prev => {
                const newAns = { ...prev };
                Object.keys(results).forEach(qId => {
                    if (!results[qId].isCorrect) {
                    newAns[qId] = '';
                    }
                });
                return newAns;
                });
                setResults({});
                setScreen('test');
            };

            const goToNextTestOrResult = () => {
                if (currentTestIdx + 1 < testsToPlay.length) {
                setCurrentTestIdx(prev => prev + 1);
                setAnswers({});
                setResults({});
                setScreen('test');
                } else {
                setSessionStats(prev => ({ ...prev, endTime: new Date() }));
                setScreen('results');
                }
            };

            const renderTextWithGaps = () => {
                const currentTest = testsToPlay[currentTestIdx];
                if (!currentTest) return null;

                const parts = currentTest.text.split(/(\[EX\]|\[\d+\]|<b>|<\/b>)/g);
                let isBold = false;
                const elements = [];

                parts.forEach((part, index) => {
                if (!part) return;
                if (part === '<b>') { isBold = true; return; }
                if (part === '</b>') { isBold = false; return; }

                const fontClass = isBold ? "font-bold text-gray-800" : "text-gray-700";

                if (part === '[EX]') {
                    elements.push(
                    <span key={`ex-${index}`} className={`inline-flex items-center mx-1 ${fontClass}`}>
                        <span className="font-extrabold mr-2 border-b-2 border-transparent" style={{ color: CONFIG.colors.primary }}>Ex</span>
                        <span className="font-bold text-gray-500 border-b-2 border-dashed border-gray-400 px-3 text-center min-w-[60px] bg-white rounded-t">
                        {currentTest.example.answer}
                        </span>
                    </span>
                    );
                    return;
                }

                const match = part.match(/^\[(\d+)\]$/);
                if (match) {
                    const qId = parseInt(match[1], 10);
                    const res = results[qId];
                    
                    if (screen === 'review' && res) {
                    if (res.isCorrect) {
                        elements.push(
                        <span key={`gap-${index}`} className={`inline-flex items-center mx-1 ${fontClass}`}>
                            <span className="font-extrabold mr-2" style={{ color: CONFIG.colors.correct }}>{qId}</span>
                            <input type="text" readOnly className="cloze-input correct" value={res.actual} />
                        </span>
                        );
                    } else {
                        elements.push(
                        <span key={`gap-${index}`} className={`inline-flex items-center mx-1 relative group ${fontClass}`}>
                            <span className="font-extrabold mr-2" style={{ color: CONFIG.colors.incorrect }}>{qId}</span>
                            <input type="text" readOnly className="cloze-input incorrect" value="" />
                            <span className="absolute -top-10 left-1/2 transform -translate-x-1/2 text-white rounded px-3 py-1 text-sm font-bold shadow-lg whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none" style={{ backgroundColor: CONFIG.colors.incorrect }}>
                            Correct: {res.expected}
                            </span>
                        </span>
                        );
                    }
                    } else {
                    elements.push(
                        <span key={`gap-${index}`} className={`inline-flex items-center mx-1 ${fontClass}`}>
                        <span className="font-extrabold mr-2" style={{ color: CONFIG.colors.primary }}>{qId}</span>
                        <input
                            type="text"
                            autoComplete="off"
                            className="cloze-input"
                            value={answers[qId] || ''}
                            onChange={(e) => handleInputChange(qId, e.target.value)}
                            placeholder="..."
                        />
                        </span>
                    );
                    }
                    return;
                }

                elements.push(
                    <span key={`text-${index}`} className={fontClass}>
                    {part.split('\n').map((line, i, arr) => (
                        <React.Fragment key={i}>
                        {line}
                        {i < arr.length - 1 && <div className="h-4"></div>}
                        </React.Fragment>
                    ))}
                    </span>
                );
                });

                return (
                <div className="text-[1.15rem] leading-[2.8rem] text-justify">
                    {elements}
                </div>
                );
            };

            /* WELCOME SCREEN */
            if (screen === 'welcome') {
                const testOptions = Array.from({ length: TEST_DATA.length }, (_, i) => i + 1);

                return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="bg-white rounded-[2rem] p-8 max-w-md w-full shadow-[0_10px_40px_-10px_rgba(165,214,167,0.5)] relative z-10 border-[6px]" style={{ borderColor: CONFIG.colors.secondary }}>
                    
                    <div className="w-full h-48 rounded-2xl overflow-hidden mb-6 border-2 shadow-inner" style={{ borderColor: CONFIG.colors.background }}>
                        <img src={CONFIG.bannerUrl} alt="Flyers Banner" className="w-full h-full object-cover" />
                    </div>

                    <div className="text-center mb-8">
                        <h1 className="text-3xl font-extrabold mb-2 tracking-tight" style={{ color: CONFIG.colors.primary }}>Flyers Part 4</h1>
                        <p className="text-gray-500 font-semibold">Reading & Writing Practice</p>
                    </div>

                    <form onSubmit={startGame} className="space-y-6">
                        <div>
                        <label className="block text-gray-700 text-sm uppercase font-bold mb-2 tracking-wider">Student's Name</label>
                        <input 
                            type="text" 
                            required
                            className="w-full px-5 py-4 rounded-xl border-2 focus:ring-4 outline-none text-lg font-bold text-gray-700 transition-all bg-gray-50 focus:bg-white"
                            style={{ borderColor: '#E5E7EB', '--tw-ring-color': CONFIG.colors.secondary }}
                            placeholder="Enter your name..."
                            value={studentName}
                            onChange={e => setStudentName(e.target.value)}
                            onFocus={(e) => e.target.style.borderColor = CONFIG.colors.primary}
                            onBlur={(e) => e.target.style.borderColor = '#E5E7EB'}
                        />
                        </div>
                        
                        <div>
                        <label className="block text-gray-700 text-sm uppercase font-bold mb-2 tracking-wider">Number of Tests</label>
                        <select 
                            className="w-full px-5 py-4 rounded-xl border-2 focus:ring-4 outline-none text-lg font-bold text-gray-700 bg-gray-50 focus:bg-white transition-all appearance-none cursor-pointer"
                            style={{ borderColor: '#E5E7EB', '--tw-ring-color': CONFIG.colors.secondary }}
                            value={numTests}
                            onChange={e => setNumTests(Number(e.target.value))}
                            onFocus={(e) => e.target.style.borderColor = CONFIG.colors.primary}
                            onBlur={(e) => e.target.style.borderColor = '#E5E7EB'}
                        >
                            {testOptions.map(n => (
                            <option key={n} value={n}>{n} Test{n > 1 ? 's' : ''}</option>
                            ))}
                        </select>
                        </div>

                        <button type="submit" className="w-full text-white font-bold py-4 px-8 rounded-xl text-lg shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all duration-200 flex items-center justify-center gap-2" style={{ backgroundColor: CONFIG.colors.primary }}>
                        <Play size={20} /> Let's Start!
                        </button>
                    </form>
                    </div>
                </div>
                );
            }

            /* TEST & REVIEW SCREEN */
            if (screen === 'test' || screen === 'review') {
                const currentTest = testsToPlay[currentTestIdx];
                const isAllCorrect = currentTest.questions.every(q => results[q.id]?.isCorrect);

                return (
                <div className="min-h-screen p-4 md:p-6 lg:p-10 font-sans text-gray-800">
                    <div className="max-w-[1400px] mx-auto">
                    
                    <div className="flex flex-col sm:flex-row justify-between items-center mb-6 bg-white py-3 px-6 rounded-2xl shadow-sm border border-gray-100">
                        <div className="flex items-center gap-4 mb-2 sm:mb-0">
                        <span className="text-sm font-extrabold px-4 py-1.5 rounded-lg tracking-wide uppercase" style={{ backgroundColor: '#FDF2F8', color: CONFIG.colors.primary }}>
                            Test {currentTestIdx + 1} / {testsToPlay.length}
                        </span>
                        <span className="font-bold text-gray-600">Student: <span className="text-gray-900">{studentName}</span></span>
                        </div>
                        
                        {screen === 'review' && !isAllCorrect && (
                        <div className="flex items-center gap-2 font-bold px-5 py-2 rounded-xl border shadow-inner" style={{ color: CONFIG.colors.incorrect, backgroundColor: '#FCE7F3', borderColor: '#FBCFE8' }}>
                            <Clock size={20} className="animate-pulse" /> Try again in {timeLeft}s
                        </div>
                        )}
                        {screen === 'review' && isAllCorrect && (
                        <div className="flex items-center gap-2 font-bold px-5 py-2 rounded-xl border" style={{ color: CONFIG.colors.correct, backgroundColor: '#DCFCE7', borderColor: '#A7F3D0' }}>
                            <CheckCircle size={20} /> Excellent! Moving to next...
                        </div>
                        )}
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-6 items-start">
                        
                        <div className="lg:col-span-8 bg-white rounded-3xl p-6 md:p-10 shadow-md border-t-[8px]" style={{ borderColor: CONFIG.colors.primary }}>
                        <h2 className="text-3xl font-extrabold text-center mb-8 text-gray-800 tracking-tight">{currentTest.title}</h2>
                        
                        {currentTest.imageUrl && (
                            <div className="flex justify-center mb-10">
                            <img src={currentTest.imageUrl} alt={currentTest.title} className="max-w-full h-auto max-h-[250px] object-contain rounded-2xl shadow-sm border border-gray-100" />
                            </div>
                        )}

                        <div className="p-6 md:p-8 rounded-2xl border" style={{ backgroundColor: CONFIG.colors.background, borderColor: CONFIG.colors.secondary }}>
                            {renderTextWithGaps()}
                        </div>
                        </div>

                        <div className="lg:col-span-4 bg-white rounded-3xl shadow-md border-t-[8px] flex flex-col sticky top-6 max-h-[calc(100vh-2rem)] overflow-hidden" style={{ borderColor: CONFIG.colors.secondary }}>
                        <div className="p-6 pb-2 border-b border-gray-100 flex-shrink-0">
                            <h3 className="text-2xl font-extrabold text-center text-gray-800">Options</h3>
                        </div>
                        
                        <div className="flex-1 overflow-y-auto options-scroll p-4 space-y-3 bg-gray-50/50">
                            
                            {currentTest.imageUrl && <div className="hidden lg:block h-24 xl:h-48 transition-all"></div>}

                            <div className="flex items-center text-base p-3 rounded-xl border border-gray-200 bg-white">
                            <span className="font-bold w-20 text-sm uppercase tracking-wider" style={{ color: CONFIG.colors.secondary }}>Example</span>
                            <div className="flex-1 flex justify-between px-2 text-gray-500 font-semibold italic">
                                {currentTest.example.options.map((opt, i) => (
                                <span key={i} className="w-1/3 text-center">{opt}</span>
                                ))}
                            </div>
                            </div>

                            {currentTest.questions.map(q => {
                            const res = results[q.id];
                            const isReviewed = screen === 'review' && res;
                            const isWrong = isReviewed && !res.isCorrect;
                            
                            return (
                                <div key={q.id} className={`flex flex-col p-3 rounded-xl border-2 transition-all duration-300 ${isWrong ? 'shadow-sm' : isReviewed && res.isCorrect ? '' : 'bg-white border-transparent hover:border-gray-200 shadow-sm'}`} 
                                    style={{ 
                                        backgroundColor: isWrong ? '#FCE7F3' : (isReviewed && res.isCorrect ? '#DCFCE7' : 'white'),
                                        borderColor: isWrong ? '#FBCFE8' : (isReviewed && res.isCorrect ? '#A7F3D0' : '')
                                    }}>
                                
                                <div className="flex items-center text-lg">
                                    <span className="font-extrabold w-10 text-center text-xl" style={{ color: isWrong ? CONFIG.colors.incorrect : CONFIG.colors.primary }}>
                                    {q.id}
                                    </span>
                                    <div className="flex-1 flex justify-between px-2 font-bold text-gray-700">
                                    {q.options.map((opt, i) => {
                                        let optClass = "w-1/3 text-center py-1 rounded-md transition-colors ";
                                        let inlineStyle = {};
                                        if (isReviewed) {
                                        if (opt.toLowerCase() === q.answer.toLowerCase()) {
                                            optClass += "text-white shadow-sm";
                                            inlineStyle = { backgroundColor: CONFIG.colors.correct };
                                        } else if (isWrong && opt.toLowerCase() === res.actual.toLowerCase()) {
                                            optClass += "line-through";
                                            inlineStyle = { color: CONFIG.colors.incorrect, backgroundColor: '#FBCFE8' };
                                        }
                                        }
                                        return (
                                        <span key={i} className={optClass} style={inlineStyle}>
                                            {opt}
                                        </span>
                                        );
                                    })}
                                    </div>
                                </div>

                                {isReviewed && q.explanation && (
                                    <div className="mt-3 text-sm p-3 rounded-lg leading-relaxed border bg-white/80" style={{ borderColor: isWrong ? '#FBCFE8' : '#A7F3D0', color: isWrong ? CONFIG.colors.incorrect : CONFIG.colors.correct }}>
                                    <span className="font-bold block mb-1 uppercase tracking-wide text-xs opacity-80">💡 Giải thích:</span> 
                                    {q.explanation}
                                    </div>
                                )}
                                </div>
                            );
                            })}
                        </div>

                        <div className="p-4 bg-white border-t border-gray-100 flex-shrink-0">
                            {screen === 'test' ? (
                            <button 
                                onClick={handleSubmit}
                                className="w-full text-white font-extrabold py-4 rounded-xl text-lg shadow-lg hover:shadow-xl transform transition hover:-translate-y-0.5 flex items-center justify-center gap-2"
                                style={{ backgroundColor: CONFIG.colors.primary }}
                            >
                                <CheckCircle /> Check Answers
                            </button>
                            ) : (
                            isAllCorrect ? (
                                <button 
                                onClick={() => { clearInterval(timerRef.current); goToNextTestOrResult(); }}
                                className="w-full text-gray-800 font-extrabold py-4 rounded-xl text-lg shadow-lg flex items-center justify-center gap-2 animate-bounce"
                                style={{ backgroundColor: CONFIG.colors.secondary }}
                                >
                                Next Test <ChevronRight />
                                </button>
                            ) : (
                                <button 
                                onClick={skipReview}
                                className="w-full text-white font-extrabold py-4 rounded-xl text-lg shadow-lg flex items-center justify-center gap-2 transition-transform hover:scale-[1.02]"
                                style={{ backgroundColor: '#F59E0B' }}
                                >
                                <RefreshCcw size={20}/> Try Again Now
                                </button>
                            )
                            )}
                        </div>
                        </div>

                    </div>
                    </div>
                </div>
                );
            }

            /* RESULTS SCREEN */
            if (screen === 'results') {
                const totalCorrect = sessionStats.testScores.reduce((sum, test) => sum + test.correct, 0);
                const totalQuestions = sessionStats.testScores.reduce((sum, test) => sum + test.total, 0);
                const percent = Math.round((totalCorrect / totalQuestions) * 100);

                return (
                <div className="min-h-screen flex items-center justify-center p-4" style={{ backgroundColor: CONFIG.colors.background }}>
                    <div className="bg-white rounded-3xl p-8 md:p-12 max-w-2xl w-full shadow-2xl relative overflow-hidden border border-gray-100">
                    
                    <div className="absolute top-0 left-0 w-full h-3" style={{ background: `linear-gradient(to right, ${CONFIG.colors.secondary}, ${CONFIG.colors.primary})` }}></div>
                    
                    <div className="text-center mb-10 mt-4">
                        <Award size={80} className="mx-auto text-yellow-400 mb-4 drop-shadow-md" />
                        <h1 className="text-4xl font-extrabold text-gray-800 mb-2">Practice Completed!</h1>
                        <p className="text-xl text-gray-500 font-semibold">Student: <span style={{ color: CONFIG.colors.primary }}>{studentName}</span></p>
                    </div>

                    <div className="bg-gray-50 rounded-2xl p-6 mb-8 border border-gray-200">
                        <h3 className="text-sm uppercase tracking-wider font-extrabold text-gray-400 mb-4">Session Details</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-600 font-medium">
                        <p>📅 Date: <span className="font-bold text-gray-800">{sessionStats.endTime?.toLocaleDateString('vi-VN')}</span></p>
                        <p>🕰 Time: <span className="font-bold" style={{ color: CONFIG.colors.primary }}>{getDurationString(sessionStats.startTime, sessionStats.endTime)}</span></p>
                        <p>⏳ Start: <span className="font-bold text-gray-800">{sessionStats.startTime?.toLocaleTimeString('vi-VN', {hour: '2-digit', minute:'2-digit'})}</span></p>
                        <p>⌛️ Finish: <span className="font-bold text-gray-800">{sessionStats.endTime?.toLocaleTimeString('vi-VN', {hour: '2-digit', minute:'2-digit'})}</span></p>
                        </div>
                    </div>

                    <div className="mb-8">
                        <h3 className="text-xl font-extrabold text-gray-800 mb-4 flex items-center justify-between">
                        <span>Final Score:</span>
                        <span className={`text-3xl ${percent >= 80 ? '' : percent >= 50 ? 'text-[#D97706]' : ''}`} style={{ color: percent >= 80 ? CONFIG.colors.correct : (percent < 50 ? CONFIG.colors.incorrect : undefined) }}>
                            {totalCorrect}/{totalQuestions} <span className="text-xl opacity-70">({percent}%)</span>
                        </span>
                        </h3>
                        
                        <div className="space-y-3">
                        {sessionStats.testScores.map((score, i) => (
                            <div key={i} className="flex justify-between items-center bg-white border-2 p-4 rounded-xl" style={{ borderColor: CONFIG.colors.background }}>
                            <span className="font-bold text-gray-700">Test {i + 1}: {score.title}</span>
                            <span className="font-extrabold px-3 py-1 rounded-lg text-sm border" 
                                    style={{ 
                                        backgroundColor: score.correct === score.total ? '#DCFCE7' : '#FEF3C7',
                                        color: score.correct === score.total ? CONFIG.colors.correct : '#B45309',
                                        borderColor: score.correct === score.total ? '#A7F3D0' : '#FDE68A'
                                    }}>
                                {score.correct} / {score.total} correct
                            </span>
                            </div>
                        ))}
                        </div>
                        <p className="text-sm text-gray-400 mt-4 text-center font-medium">* Scores are based on your first attempt for each test.</p>
                    </div>

                    <button 
                        onClick={() => window.location.reload()}
                        className="w-full text-white font-extrabold py-4 rounded-xl text-lg shadow-lg hover:shadow-xl transition-all hover:-translate-y-0.5"
                        style={{ backgroundColor: CONFIG.colors.primary }}
                    >
                        Practice Again
                    </button>
                    </div>
                </div>
                );
            }

            return null;
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
